- name: collect interactive user home dir stat
  stat:
      path: "{{item.home}}"
  loop: "{{passwd.passwd}}"
  when: item.login in interactive_accounts
  register: interactive_home_stat

# Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# V-72017 (SV-86641r2_rule)
- name: "check stat mode is <= {{home_dirs_perm|oct}}"
  file:
      path: "{{item.stat.path}}"
      mode: "{{home_dirs_perm}}"
  loop: "{{interactive_home_stat.results}}"
  when:
      - not item is skipped
      - item.stat.mode is perm_gt(home_dirs_perm)

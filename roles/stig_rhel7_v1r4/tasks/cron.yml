- name: check for /etc/cron.allow
  stat:
      path: /etc/cron.allow
  register: cron_allow_stat

- name: cron_allow_stat
  debug:
    msg: '{{cron_allow_stat}}'

# Vuln ID: V-72053
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86677r2_rule
# STIG ID: RHEL-07-021110
# Rule Title: If the cron.allow file exists it must be owned by root.
# Discussion: If the owner of the "cron.allow" file is not set to root, the possibility exists for an unauthorized user to view or to edit sensitive information.
# IA Controls:
# Check Content: Verify that the "cron.allow" file is owned by root.
#
# Check the owner of the "cron.allow" file with the following command:
#
# # ls -al /etc/cron.allow
# -rw------- 1 root root 6 Mar  5  2011 /etc/cron.allow
#
# If the "cron.allow" file exists and has an owner other than root, this is a finding.
# Fix Text: Set the owner on the "/etc/cron.allow" file to root with the following command:
#
# # chown root /etc/cron.allow
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: pass stig_rhel7_v1r4 v_72053
  set_fact:
    stig_rhel7_v1r4_v_72053_result: 'pass'
  when:
    - "'v_72053' in stig_rhel7_v1r4_checks"
    - cron_allow_stat.stat.exists
    - cron_allow_stat.stat.pw_name == 'root'

- name: fail stig_rhel7_v1r4 v_72053
  set_fact:
    stig_rhel7_v1r4_v_72053_result: 'fail'
  when:
    - "'v_72053' in stig_rhel7_v1r4_checks"
    - stig_rhel7_v1r4_v_72053_result != 'pass'


# Vuln ID: V-72055
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86679r1_rule
# STIG ID: RHEL-07-021120
# Rule Title: If the cron.allow file exists it must be group-owned by root.
# Discussion: If the group owner of the "cron.allow" file is not set to root, sensitive information could be viewed or edited by unauthorized users.
# IA Controls:
# Check Content: Verify that the "cron.allow" file is group-owned by root.
#
# Check the group owner of the "cron.allow" file with the following command:
#
# # ls -al /etc/cron.allow
# -rw------- 1 root root 6 Mar  5  2011 /etc/cron.allow
#
# If the "cron.allow" file exists and has a group owner other than root, this is a finding.
# Fix Text: Set the group owner on the "/etc/cron.allow" file to root with the following command:
#
# # chgrp root /etc/cron.allow
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: pass stig_rhel7_v1r4 v_72055
  set_fact:
    stig_rhel7_v1r4_v_72055_result: 'pass'
  when:
    - "'v_72055' in stig_rhel7_v1r4_checks"
    - cron_allow_stat.stat.exists
    - cron_allow_stat.stat.gr_name == 'root'

- name: fail stig_rhel7_v1r4 v_72055
  set_fact:
    stig_rhel7_v1r4_v_72055_result: 'fail'
  when:
    - "'v_72055' in stig_rhel7_v1r4_checks"
    - stig_rhel7_v1r4_v_72055_result != 'pass'

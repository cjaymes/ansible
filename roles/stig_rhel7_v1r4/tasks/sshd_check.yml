# Vuln ID: V-71939
# Severity: high
# Group Title: SRG-OS-000106-GPOS-00053
# Rule ID: SV-86563r2_rule
# STIG ID: RHEL-07-010300
# Rule Title: The SSH daemon must not allow authentication using an empty password.
# Discussion: Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere.
# IA Controls:
# Check Content: To determine how the SSH daemon's "PermitEmptyPasswords" option is set, run the following command:
#
# # grep -i PermitEmptyPasswords /etc/ssh/sshd_config
# PermitEmptyPasswords no
#
# If no line, a commented line, or a line indicating the value "no" is returned, the required value is set.
#
# If the required value is not set, this is a finding.
# Fix Text: To explicitly disallow remote logon from accounts with empty passwords, add or correct the following line in "/etc/ssh/sshd_config":
#
# PermitEmptyPasswords no
#
# The SSH service must be restarted for changes to take effect.  Any accounts with empty passwords should be disabled immediately, and PAM configuration should prevent users from being able to assign themselves empty passwords.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000766
# The information system implements multifactor authentication for network access to non-privileged accounts.
# NIST SP 800-53 :: IA-2 (2)
# NIST SP 800-53A :: IA-2 (2).1
# NIST SP 800-53 Revision 4 :: IA-2 (2)
#
#
- name: check stig_rhel7_v1r4 v_71939
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_71939': 'fail'})}}"
  when: '"v_71939" in stig_rhel7_v1r4_checks'


# Vuln ID: V-71957
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00229
# Rule ID: SV-86581r2_rule
# STIG ID: RHEL-07-010460
# Rule Title: The operating system must not allow users to override SSH environment variables.
# Discussion: Failure to restrict system access to authenticated users negatively impacts operating system security.
# IA Controls:
# Check Content: Verify the operating system does not allow users to override environment variables to the SSH daemon.
#
# Check for the value of the "PermitUserEnvironment" keyword with the following command:
#
# # grep -i permituserenvironment /etc/ssh/sshd_config
# PermitUserEnvironment no
#
# If the "PermitUserEnvironment" keyword is not set to "no", is missing, or is commented out, this is a finding.
# Fix Text: Configure the operating system to not allow users to override environment variables to the SSH daemon.
#
# Edit the "/etc/ssh/sshd_config" file to uncomment or add the line for "PermitUserEnvironment" keyword and set the value to "no":
#
# PermitUserEnvironment no
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_71957
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_71957': 'fail'})}}"
  when: '"v_71957" in stig_rhel7_v1r4_checks'


# Vuln ID: V-71959
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00229
# Rule ID: SV-86583r2_rule
# STIG ID: RHEL-07-010470
# Rule Title: The operating system must not allow a non-certificate trusted host SSH logon to the system.
# Discussion: Failure to restrict system access to authenticated users negatively impacts operating system security.
# IA Controls:
# Check Content: Verify the operating system does not allow a non-certificate trusted host SSH logon to the system.
#
# Check for the value of the "HostbasedAuthentication" keyword with the following command:
#
# # grep -i hostbasedauthentication /etc/ssh/sshd_config
# HostbasedAuthentication no
#
# If the "HostbasedAuthentication" keyword is not set to "no", is missing, or is commented out, this is a finding.
# Fix Text: Configure the operating system to not allow a non-certificate trusted host SSH logon to the system.
#
# Edit the "/etc/ssh/sshd_config" file to uncomment or add the line for "HostbasedAuthentication" keyword and set the value to "no":
#
# HostbasedAuthentication no
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_71959
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_71959': 'fail'})}}"
  when: '"v_71959" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72221
# Severity: medium
# Group Title: SRG-OS-000033-GPOS-00014
# Rule ID: SV-86845r2_rule
# STIG ID: RHEL-07-040110
# Rule Title: A FIPS 140-2 approved cryptographic algorithm must be used for SSH communications.
# Discussion: Unapproved mechanisms that are used for authentication to the cryptographic module are not verified and therefore cannot be relied upon to provide confidentiality or integrity, and DoD data may be compromised.
#
# Operating systems utilizing encryption are required to use FIPS-compliant mechanisms for authenticating to cryptographic modules.
#
# FIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules utilize authentication that meets DoD requirements. This allows for Security Levels 1, 2, 3, or 4 for use on a general purpose computing system.
#
# Satisfies: SRG-OS-000033-GPOS-00014, SRG-OS-000120-GPOS-00061, SRG-OS-000125-GPOS-00065, SRG-OS-000250-GPOS-00093, SRG-OS-000393-GPOS-00173
# IA Controls:
# Check Content: Verify the operating system uses mechanisms meeting the requirements of applicable federal laws, Executive orders, directives, policies, regulations, standards, and guidance for authentication to a cryptographic module.
#
# Note: If RHEL-07-021350 is a finding, this is automatically a finding as the system cannot implement FIPS 140-2-approved cryptographic algorithms and hashes.
#
# The location of the "sshd_config" file may vary if a different daemon is in use.
#
# Inspect the "Ciphers" configuration with the following command:
#
# # grep -i ciphers /etc/ssh/sshd_config
# Ciphers aes128-ctr,aes192-ctr,aes256-ctr
#
# If any ciphers other than "aes128-ctr", "aes192-ctr", or "aes256-ctr" are listed, the "Ciphers" keyword is missing, or the retuned line is commented out, this is a finding.
# Fix Text: Configure SSH to use FIPS 140-2 approved cryptographic algorithms.
#
# Add the following line (or modify the line to have the required value) to the "/etc/ssh/sshd_config" file (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor).
#
# Ciphers aes128-ctr,aes192-ctr,aes256-ctr
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000068
# The information system implements cryptographic mechanisms to protect the confidentiality of remote access sessions.
# NIST SP 800-53 :: AC-17 (2)
# NIST SP 800-53A :: AC-17 (2).1
# NIST SP 800-53 Revision 4 :: AC-17 (2)
#
# CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
# CCI-000803
# The information system implements mechanisms for authentication to a cryptographic module that meet the requirements of applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance for such authentication.
# NIST SP 800-53 :: IA-7
# NIST SP 800-53A :: IA-7.1
# NIST SP 800-53 Revision 4 :: IA-7
#
#
- name: check stig_rhel7_v1r4 v_72221
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72221': 'fail'})}}"
  when: '"v_72221" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72225
# Severity: medium
# Group Title: SRG-OS-000023-GPOS-00006
# Rule ID: SV-86849r3_rule
# STIG ID: RHEL-07-040170
# Rule Title: The Standard Mandatory DoD Notice and Consent Banner must be displayed immediately prior to, or as part of, remote access logon prompts.
# Discussion: Display of a standardized and approved use notification before granting access to the publicly accessible operating system ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.
#
# System use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.
#
# The banner must be formatted in accordance with applicable DoD policy. Use the following verbiage for operating systems that can accommodate banners of 1300 characters:
#
# "You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.
#
# By using this IS (which includes any device attached to this IS), you consent to the following conditions:
#
# -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.
#
# -At any time, the USG may inspect and seize data stored on this IS.
#
# -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.
#
# -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.
#
# -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details."
#
# Satisfies: SRG-OS-000023-GPOS-00006, SRG-OS-000024-GPOS-00007 , SRG-OS-000228-GPOS-00088
# IA Controls:
# Check Content: Verify any publicly accessible connection to the operating system displays the Standard Mandatory DoD Notice and Consent Banner before granting access to the system.
#
# Check for the location of the banner file being used with the following command:
#
# # grep -i banner /etc/ssh/sshd_config
#
# banner /etc/issue
#
# This command will return the banner keyword and the name of the file that contains the ssh banner (in this case "/etc/issue").
#
# If the line is commented out, this is a finding.
#
# View the file specified by the banner keyword to check that it matches the text of the Standard Mandatory DoD Notice and Consent Banner:
#
# "You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By using this IS (which includes any device attached to this IS), you consent to the following conditions:
#
# -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.
#
# -At any time, the USG may inspect and seize data stored on this IS.
#
# -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.
#
# -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.
#
# -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details."
#
# If the system does not display a graphical logon banner or the banner does not match the Standard Mandatory DoD Notice and Consent Banner, this is a finding.
#
# If the text in the file does not match the Standard Mandatory DoD Notice and Consent Banner, this is a finding.
# Fix Text: Configure the operating system to display the Standard Mandatory DoD Notice and Consent Banner before granting access to the system via the ssh.
#
# Edit the "/etc/ssh/sshd_config" file to uncomment the banner keyword and configure it to point to a file that will contain the logon banner (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor). An example configuration line is:
#
# banner /etc/issue
#
# Either create the file containing the banner or replace the text in the file with the Standard Mandatory DoD Notice and Consent Banner. The DoD required text is:
#
# "You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By using this IS (which includes any device attached to this IS), you consent to the following conditions:
#
# -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.
#
# -At any time, the USG may inspect and seize data stored on this IS.
#
# -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.
#
# -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.
#
# -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details."
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000048
# The information system displays an organization-defined system use notification message or banner before granting access to the system that provides privacy and security notices consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.
# NIST SP 800-53 :: AC-8 a
# NIST SP 800-53A :: AC-8.1 (ii)
# NIST SP 800-53 Revision 4 :: AC-8 a
#
# CCI-000050
# The information system retains the notification message or banner on the screen until users acknowledge the usage conditions and take explicit actions to log on to or further access.
# NIST SP 800-53 :: AC-8 b
# NIST SP 800-53A :: AC-8.1 (iii)
# NIST SP 800-53 Revision 4 :: AC-8 b
#
# CCI-001384
# The information system, for publicly accessible systems, displays system use information organization-defined conditions before granting further access.
# NIST SP 800-53 :: AC-8 c
# NIST SP 800-53A :: AC-8.2 (i)
# NIST SP 800-53 Revision 4 :: AC-8 c 1
#
# CCI-001385
# The information system, for publicly accessible systems, displays references, if any, to monitoring that are consistent with privacy accommodations for such systems that generally prohibit those activities.
# NIST SP 800-53 :: AC-8 c
# NIST SP 800-53A :: AC-8.2 (ii)
# NIST SP 800-53 Revision 4 :: AC-8 c 2
#
# CCI-001386
# The information system for publicly accessible systems displays references, if any, to recording that are consistent with privacy accommodations for such systems that generally prohibit those activities.
# NIST SP 800-53 :: AC-8 c
# NIST SP 800-53A :: AC-8.2 (ii)
# NIST SP 800-53 Revision 4 :: AC-8 c 2
#
# CCI-001387
# The information system for publicly accessible systems displays references, if any, to auditing that are consistent with privacy accommodations for such systems that generally prohibit those activities.
# NIST SP 800-53 :: AC-8 c
# NIST SP 800-53A :: AC-8.2 (ii)
# NIST SP 800-53 Revision 4 :: AC-8 c 2
#
# CCI-001388
# The information system, for publicly accessible systems, includes a description of the authorized uses of the system.
# NIST SP 800-53 :: AC-8 c
# NIST SP 800-53A :: AC-8.2 (iii)
# NIST SP 800-53 Revision 4 :: AC-8 c 3
#
#
- name: check stig_rhel7_v1r4 v_72225
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72225': 'fail'})}}"
  when: '"v_72225" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72233
# Severity: medium
# Group Title: SRG-OS-000423-GPOS-00187
# Rule ID: SV-86857r2_rule
# STIG ID: RHEL-07-040300
# Rule Title: All networked systems must have SSH installed.
# Discussion: Without protection of the transmitted information, confidentiality and integrity may be compromised because unprotected communications can be intercepted and either read or altered.
#
# This requirement applies to both internal and external networks and all types of information system components from which information can be transmitted (e.g., servers, mobile devices, notebook computers, printers, copiers, scanners, and facsimile machines). Communication paths outside the physical protection of a controlled boundary are exposed to the possibility of interception and modification.
#
# Protecting the confidentiality and integrity of organizational information can be accomplished by physical means (e.g., employing physical distribution systems) or by logical means (e.g., employing cryptographic techniques). If physical means of protection are employed, logical means (cryptography) do not have to be employed, and vice versa.
#
# Satisfies: SRG-OS-000423-GPOS-00187, SRG-OS-000424-GPOS-00188, SRG-OS-000425-GPOS-00189, SRG-OS-000426-GPOS-00190
# IA Controls:
# Check Content: Check to see if sshd is installed with the following command:
#
# # yum list installed | grep  ssh
# libssh2.x86_64                           1.4.3-8.el7               @anaconda/7.1
# openssh.x86_64                           6.6.1p1-11.el7            @anaconda/7.1
# openssh-clients.x86_64                   6.6.1p1-11.el7            @anaconda/7.1
# openssh-server.x86_64                    6.6.1p1-11.el7            @anaconda/7.1
#
# If the "SSH server" package is not installed, this is a finding.
#
# If the "SSH client" package is not installed, this is a finding.
# Fix Text: Install SSH packages onto the host with the following commands:
#
# # yum install openssh-clients.x86_64
# # yum install openssh-server.x86_64
#
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-002418
# The information system protects the confidentiality and/or integrity of transmitted information.
# NIST SP 800-53 Revision 4 :: SC-8
#
# CCI-002420
# The information system maintains the confidentiality and/or integrity of information during preparation for transmission.
# NIST SP 800-53 Revision 4 :: SC-8 (2)
#
# CCI-002421
# The information system implements cryptographic mechanisms to prevent unauthorized disclosure of information and/or detect changes to information during transmission unless otherwise protected by organization-defined alternative physical safeguards.
# NIST SP 800-53 Revision 4 :: SC-8 (1)
#
# CCI-002422
# The information system maintains the confidentiality and/or integrity of information during reception.
# NIST SP 800-53 Revision 4 :: SC-8 (2)
#
#
- name: check stig_rhel7_v1r4 v_72233
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72233': 'fail'})}}"
  when: '"v_72233" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72235
# Severity: medium
# Group Title: SRG-OS-000423-GPOS-00187
# Rule ID: SV-86859r2_rule
# STIG ID: RHEL-07-040310
# Rule Title: All networked systems must use SSH for confidentiality and integrity of transmitted and received information as well as information during preparation for transmission.
# Discussion: Without protection of the transmitted information, confidentiality and integrity may be compromised because unprotected communications can be intercepted and either read or altered.
#
# This requirement applies to both internal and external networks and all types of information system components from which information can be transmitted (e.g., servers, mobile devices, notebook computers, printers, copiers, scanners, and facsimile machines). Communication paths outside the physical protection of a controlled boundary are exposed to the possibility of interception and modification.
#
# Protecting the confidentiality and integrity of organizational information can be accomplished by physical means (e.g., employing physical distribution systems) or by logical means (e.g., employing cryptographic techniques). If physical means of protection are employed, then logical means (cryptography) do not have to be employed, and vice versa.
#
# Satisfies: SRG-OS-000423-GPOS-00187, SRG-OS-000423-GPOS-00188, SRG-OS-000423-GPOS-00189, SRG-OS-000423-GPOS-00190
# IA Controls:
# Check Content: Verify SSH is loaded and active with the following command:
#
# # systemctl status sshd
#  sshd.service - OpenSSH server daemon
#    Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled)
#    Active: active (running) since Tue 2015-11-17 15:17:22 EST; 4 weeks 0 days ago
#  Main PID: 1348 (sshd)
#    CGroup: /system.slice/sshd.service
#            ??1348 /usr/sbin/sshd -D
#
# If "sshd" does not show a status of "active" and "running", this is a finding.
# Fix Text: Configure the SSH service to automatically start after reboot with the following command:
#
# # systemctl enable sshd ln -s '/usr/lib/systemd/system/sshd.service' '/etc/systemd/system/multi-user.target.wants/sshd.service'
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-002418
# The information system protects the confidentiality and/or integrity of transmitted information.
# NIST SP 800-53 Revision 4 :: SC-8
#
# CCI-002420
# The information system maintains the confidentiality and/or integrity of information during preparation for transmission.
# NIST SP 800-53 Revision 4 :: SC-8 (2)
#
# CCI-002421
# The information system implements cryptographic mechanisms to prevent unauthorized disclosure of information and/or detect changes to information during transmission unless otherwise protected by organization-defined alternative physical safeguards.
# NIST SP 800-53 Revision 4 :: SC-8 (1)
#
# CCI-002422
# The information system maintains the confidentiality and/or integrity of information during reception.
# NIST SP 800-53 Revision 4 :: SC-8 (2)
#
#
- name: check stig_rhel7_v1r4 v_72235
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72235': 'fail'})}}"
  when: '"v_72235" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72237
# Severity: medium
# Group Title: SRG-OS-000163-GPOS-00072
# Rule ID: SV-86861r3_rule
# STIG ID: RHEL-07-040320
# Rule Title: All network connections associated with SSH traffic must terminate at the end of the session or after 10 minutes of inactivity, except to fulfill documented and validated mission requirements.
# Discussion: Terminating an idle SSH session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle SSH session will also free up resources committed by the managed network element.
#
# Terminating network connections associated with communications sessions includes, for example, de-allocating associated TCP/IP address/port pairs at the operating system level and de-allocating networking assignments at the application level if multiple application sessions are using a single operating system-level network connection. This does not mean that the operating system terminates all sessions or network access; it only ends the inactive session and releases the resources associated with that session.
#
# Satisfies: SRG-OS-000163-GPOS-00072, SRG-OS-000279-GPOS-00109
# IA Controls:
# Check Content: Verify the operating system automatically terminates a user session after inactivity time-outs have expired.
#
# Check for the value of the "ClientAliveInterval" keyword with the following command:
#
# # grep -iw clientaliveinterval /etc/ssh/sshd_config
#
# ClientAliveInterval 600
#
# If "ClientAliveInterval" is not configured, commented out, or has a value of "0", this is a finding.
#
# If "ClientAliveInterval" has a value that is greater than "600" and is not documented with the Information System Security Officer (ISSO) as an operational requirement, this is a finding.
# Fix Text: Configure the operating system to automatically terminate a user session after inactivity time-outs have expired or at shutdown.
#
# Add the following line (or modify the line to have the required value) to the "/etc/ssh/sshd_config" file (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor):
#
# ClientAliveInterval 600
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-001133
# The information system terminates the network connection associated with a communications session at the end of the session or after an organization-defined time period of inactivity.
# NIST SP 800-53 :: SC-10
# NIST SP 800-53A :: SC-10.1 (ii)
# NIST SP 800-53 Revision 4 :: SC-10
#
# CCI-002361
# The information system automatically terminates a user session after organization-defined conditions or trigger events requiring session disconnect.
# NIST SP 800-53 Revision 4 :: AC-12
#
#
- name: check stig_rhel7_v1r4 v_72237
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72237': 'fail'})}}"
  when: '"v_72237" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72239
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86863r3_rule
# STIG ID: RHEL-07-040330
# Rule Title: The SSH daemon must not allow authentication using RSA rhosts authentication.
# Discussion: Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere.
# IA Controls:
# Check Content: Verify the SSH daemon does not allow authentication using RSA rhosts authentication.
#
# To determine how the SSH daemon's "RhostsRSAAuthentication" option is set, run the following command:
#
# # grep RhostsRSAAuthentication /etc/ssh/sshd_config
# RhostsRSAAuthentication no
#
# If the value is returned as "yes", the returned line is commented out, or no output is returned, this is a finding.
# Fix Text: Configure the SSH daemon to not allow authentication using RSA rhosts authentication.
#
# Add the following line in "/etc/ssh/sshd_config", or uncomment the line and set the value to "no":
#
# RhostsRSAAuthentication no
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72239
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72239': 'fail'})}}"
  when: '"v_72239" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72241
# Severity: medium
# Group Title: SRG-OS-000163-GPOS-00072
# Rule ID: SV-86865r3_rule
# STIG ID: RHEL-07-040340
# Rule Title: All network connections associated with SSH traffic must terminate after a period of inactivity.
# Discussion: Terminating an idle SSH session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle SSH session will also free up resources committed by the managed network element.
#
# Terminating network connections associated with communications sessions includes, for example, de-allocating associated TCP/IP address/port pairs at the operating system level and de-allocating networking assignments at the application level if multiple application sessions are using a single operating system-level network connection. This does not mean that the operating system terminates all sessions or network access; it only ends the inactive session and releases the resources associated with that session.
#
# Satisfies: SRG-OS-000163-GPOS-00072, SRG-OS-000279-GPOS-00109
# IA Controls:
# Check Content: Check the version of the operating system with the following command:
#
# # cat /etc/redhat-release
#
# If the release is 7.4 or newer this requirement is Not Applicable.
#
# Verify the operating system automatically terminates a user session after inactivity time-outs have expired.
#
# Check for the value of the "ClientAliveCountMax" keyword with the following command:
#
# # grep -i clientalivecount /etc/ssh/sshd_config
# ClientAliveCountMax 0
#
# If "ClientAliveCountMax" is not set to "0" in "/etc/ ssh/sshd_config", this is a finding.
# Fix Text: Configure the operating system to automatically terminate a user session after inactivity time-outs have expired or at shutdown.
#
# Add the following line (or modify the line to have the required value) to the "/etc/ssh/sshd_config" file (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor):
#
# ClientAliveCountMax 0
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-001133
# The information system terminates the network connection associated with a communications session at the end of the session or after an organization-defined time period of inactivity.
# NIST SP 800-53 :: SC-10
# NIST SP 800-53A :: SC-10.1 (ii)
# NIST SP 800-53 Revision 4 :: SC-10
#
# CCI-002361
# The information system automatically terminates a user session after organization-defined conditions or trigger events requiring session disconnect.
# NIST SP 800-53 Revision 4 :: AC-12
#
#
- name: check stig_rhel7_v1r4 v_72241
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72241': 'fail'})}}"
  when: '"v_72241" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72243
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86867r2_rule
# STIG ID: RHEL-07-040350
# Rule Title: The SSH daemon must not allow authentication using rhosts authentication.
# Discussion: Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere.
# IA Controls:
# Check Content: Verify the SSH daemon does not allow authentication using known hosts authentication.
#
# To determine how the SSH daemon's "IgnoreRhosts" option is set, run the following command:
#
# # grep -i IgnoreRhosts /etc/ssh/sshd_config
#
# IgnoreRhosts yes
#
# If the value is returned as "no", the returned line is commented out, or no output is returned, this is a finding.
# Fix Text: Configure the SSH daemon to not allow authentication using known hosts authentication.
#
# Add the following line in "/etc/ssh/sshd_config", or uncomment the line and set the value to "yes":
#
# IgnoreRhosts yes
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72243
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72243': 'fail'})}}"
  when: '"v_72243" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72245
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86869r2_rule
# STIG ID: RHEL-07-040360
# Rule Title: The system must display the date and time of the last successful account logon upon an SSH logon.
# Discussion: Providing users with feedback on when account accesses via SSH last occurred facilitates user recognition and reporting of unauthorized account use.
# IA Controls:
# Check Content: Verify SSH provides users with feedback on when account accesses last occurred.
#
# Check that "PrintLastLog" keyword in the sshd daemon configuration file is used and set to "yes" with the following command:
#
# # grep -i printlastlog /etc/ssh/sshd_config
# PrintLastLog yes
#
# If the "PrintLastLog" keyword is set to "no", is missing, or is commented out, this is a finding.
# Fix Text: Configure SSH to provide users with feedback on when account accesses last occurred by setting the required configuration options in "/etc/pam.d/sshd" or in the "sshd_config" file used by the system ("/etc/ssh/sshd_config" will be used in the example) (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor).
#
# Add the following line to the top of "/etc/pam.d/sshd":
#
# session     required      pam_lastlog.so showfailed
#
# Or modify the "PrintLastLog" line in "/etc/ssh/sshd_config" to match the following:
#
# PrintLastLog yes
#
# The SSH service must be restarted for changes to "sshd_config" to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72245
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72245': 'fail'})}}"
  when: '"v_72245" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72247
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86871r2_rule
# STIG ID: RHEL-07-040370
# Rule Title: The system must not permit direct logons to the root account using remote access via SSH.
# Discussion: Even though the communications channel may be encrypted, an additional layer of security is gained by extending the policy of not logging on directly as root. In addition, logging on with a user-specific account provides individual accountability of actions performed on the system.
# IA Controls:
# Check Content: Verify remote access using SSH prevents users from logging on directly as root.
#
# Check that SSH prevents users from logging on directly as root with the following command:
#
# # grep -i permitrootlogin /etc/ssh/sshd_config
# PermitRootLogin no
#
# If the "PermitRootLogin" keyword is set to "yes", is missing, or is commented out, this is a finding.
# Fix Text: Configure SSH to stop users from logging on remotely as the root user.
#
# Edit the appropriate  "/etc/ssh/sshd_config" file to uncomment or add the line for the "PermitRootLogin" keyword and set its value to "no" (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor):
#
# PermitRootLogin no
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72247
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72247': 'fail'})}}"
  when: '"v_72247" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72249
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86873r2_rule
# STIG ID: RHEL-07-040380
# Rule Title: The SSH daemon must not allow authentication using known hosts authentication.
# Discussion: Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere.
# IA Controls:
# Check Content: Verify the SSH daemon does not allow authentication using known hosts authentication.
#
# To determine how the SSH daemon's "IgnoreUserKnownHosts" option is set, run the following command:
#
# # grep -i IgnoreUserKnownHosts /etc/ssh/sshd_config
#
# IgnoreUserKnownHosts yes
#
# If the value is returned as "no", the returned line is commented out, or no output is returned, this is a finding.
# Fix Text: Configure the SSH daemon to not allow authentication using known hosts authentication.
#
# Add the following line in "/etc/ssh/sshd_config", or uncomment the line and set the value to "yes":
#
# IgnoreUserKnownHosts yes
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72249
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72249': 'fail'})}}"
  when: '"v_72249" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72251
# Severity: high
# Group Title: SRG-OS-000074-GPOS-00042
# Rule ID: SV-86875r3_rule
# STIG ID: RHEL-07-040390
# Rule Title: The SSH daemon must be configured to only use the SSHv2 protocol.
# Discussion: SSHv1 is an insecure implementation of the SSH protocol and has many well-known vulnerability exploits. Exploits of the SSH daemon could provide immediate root access to the system.
#
# Satisfies: SRG-OS-000074-GPOS-00042, SRG-OS-000480-GPOS-00227
# IA Controls:
# Check Content: Check the version of the operating system with the following command:
#
# # cat /etc/redhat-release
#
# If the release is 7.4 or newer this requirement is Not Applicable.
#
# Verify the SSH daemon is configured to only use the SSHv2 protocol.
#
# Check that the SSH daemon is configured to only use the SSHv2 protocol with the following command:
#
# # grep -i protocol /etc/ssh/sshd_config
# Protocol 2
# #Protocol 1,2
#
# If any protocol line other than "Protocol 2" is uncommented, this is a finding.
# Fix Text: Remove all Protocol lines that reference version "1" in "/etc/ssh/sshd_config" (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor). The "Protocol" line must be as follows:
#
# Protocol 2
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000197
# The information system, for password-based authentication, transmits only encrypted representations of passwords.
# NIST SP 800-53 :: IA-5 (1) (c)
# NIST SP 800-53A :: IA-5 (1).1 (v)
# NIST SP 800-53 Revision 4 :: IA-5 (1) (c)
#
# CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72251
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72251': 'fail'})}}"
  when: '"v_72251" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72253
# Severity: medium
# Group Title: SRG-OS-000250-GPOS-00093
# Rule ID: SV-86877r2_rule
# STIG ID: RHEL-07-040400
# Rule Title: The SSH daemon must be configured to only use Message Authentication Codes (MACs) employing FIPS 140-2 approved cryptographic hash algorithms.
# Discussion: DoD information systems are required to use FIPS 140-2 approved cryptographic hash functions. The only SSHv2 hash algorithm meeting this requirement is SHA.
# IA Controls:
# Check Content: Verify the SSH daemon is configured to only use MACs employing FIPS 140-2-approved ciphers.
#
# Note: If RHEL-07-021350 is a finding, this is automatically a finding as the system cannot implement FIPS 140-2-approved cryptographic algorithms and hashes.
#
# Check that the SSH daemon is configured to only use MACs employing FIPS 140-2-approved ciphers with the following command:
#
# # grep -i macs /etc/ssh/sshd_config
# MACs hmac-sha2-256,hmac-sha2-512
#
# If any ciphers other than "hmac-sha2-256" or "hmac-sha2-512" are listed or the retuned line is commented out, this is a finding.
# Fix Text: Edit the "/etc/ssh/sshd_config" file to uncomment or add the line for the "MACs" keyword and set its value to "hmac-sha2-256" and/or "hmac-sha2-512" (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor):
#
# MACs hmac-sha2-256,hmac-sha2-512
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-001453
# The information system implements cryptographic mechanisms to protect the integrity of remote access sessions.
# NIST SP 800-53 :: AC-17 (2)
# NIST SP 800-53A :: AC-17 (2).1
# NIST SP 800-53 Revision 4 :: AC-17 (2)
#
#
- name: check stig_rhel7_v1r4 v_72253
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72253': 'fail'})}}"
  when: '"v_72253" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72255
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86879r1_rule
# STIG ID: RHEL-07-040410
# Rule Title: The SSH public host key files must have mode 0644 or less permissive.
# Discussion: If a public host key file is modified by an unauthorized user, the SSH service may be compromised.
# IA Controls:
# Check Content: Verify the SSH public host key files have mode "0644" or less permissive.
#
# Note: SSH public key files may be found in other directories on the system depending on the installation.
#
# The following command will find all SSH public key files on the system:
#
# # find /etc/ssh -name '*.pub' -exec ls -lL {} \;
#
# -rw-r--r--  1 root  wheel  618 Nov 28 06:43 ssh_host_dsa_key.pub
# -rw-r--r--  1 root  wheel  347 Nov 28 06:43 ssh_host_key.pub
# -rw-r--r--  1 root  wheel  238 Nov 28 06:43 ssh_host_rsa_key.pub
#
# If any file has a mode more permissive than "0644", this is a finding.
# Fix Text: Note: SSH public key files may be found in other directories on the system depending on the installation.
#
# Change the mode of public host key files under "/etc/ssh" to "0644" with the following command:
#
# # chmod 0644 /etc/ssh/*.key.pub
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72255
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72255': 'fail'})}}"
  when: '"v_72255" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72257
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86881r1_rule
# STIG ID: RHEL-07-040420
# Rule Title: The SSH private host key files must have mode 0600 or less permissive.
# Discussion: If an unauthorized user obtains the private SSH host key file, the host could be impersonated.
# IA Controls:
# Check Content: Verify the SSH private host key files have mode "0600" or less permissive.
#
# The following command will find all SSH private key files on the system:
#
# # find / -name '*ssh_host*key'
#
# Check the mode of the private host key files under "/etc/ssh" file with the following command:
#
# # ls -lL /etc/ssh/*key
# -rw-------  1 root  wheel  668 Nov 28 06:43 ssh_host_dsa_key
# -rw-------  1 root  wheel  582 Nov 28 06:43 ssh_host_key
# -rw-------  1 root  wheel  887 Nov 28 06:43 ssh_host_rsa_key
#
# If any file has a mode more permissive than "0600", this is a finding.
# Fix Text: Configure the mode of SSH private host key files under "/etc/ssh" to "0600" with the following command:
#
# # chmod 0600 /etc/ssh/ssh_host*key
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72257
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72257': 'fail'})}}"
  when: '"v_72257" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72259
# Severity: medium
# Group Title: SRG-OS-000364-GPOS-00151
# Rule ID: SV-86883r2_rule
# STIG ID: RHEL-07-040430
# Rule Title: The SSH daemon must not permit Generic Security Service Application Program Interface (GSSAPI) authentication unless needed.
# Discussion: GSSAPI authentication is used to provide additional authentication mechanisms to applications. Allowing GSSAPI authentication through SSH exposes the systems GSSAPI to remote hosts, increasing the attack surface of the system. GSSAPI authentication must be disabled unless needed.
# IA Controls:
# Check Content: Verify the SSH daemon does not permit GSSAPI authentication unless approved.
#
# Check that the SSH daemon does not permit GSSAPI authentication with the following command:
#
# # grep -i gssapiauth /etc/ssh/sshd_config
# GSSAPIAuthentication no
#
# If the "GSSAPIAuthentication" keyword is missing, is set to "yes" and is not documented with the Information System Security Officer (ISSO), or the returned line is commented out, this is a finding.
# Fix Text: Uncomment the "GSSAPIAuthentication" keyword in "/etc/ssh/sshd_config" (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor) and set the value to "no":
#
# GSSAPIAuthentication no
#
# The SSH service must be restarted for changes to take effect.
#
# If GSSAPI authentication is required, it must be documented, to include the location of the configuration file, with the ISSO.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000318
# The organization audits and reviews activities associated with configuration controlled changes to the system.
# NIST SP 800-53 :: CM-3 e
# NIST SP 800-53A :: CM-3.1 (v)
# NIST SP 800-53 Revision 4 :: CM-3 f
#
# CCI-000368
# The organization documents any deviations from the established configuration settings for organization-defined information system components based on organization-defined operational requirements.
# NIST SP 800-53 :: CM-6 c
# NIST SP 800-53A :: CM-6.1 (v)
# NIST SP 800-53 Revision 4 :: CM-6 c
#
# CCI-001812
# The information system prohibits user installation of software without explicit privileged status.
# NIST SP 800-53 Revision 4 :: CM-11 (2)
#
# CCI-001813
# The information system enforces access restrictions.
# NIST SP 800-53 Revision 4 :: CM-5 (1)
#
# CCI-001814
# The Information system supports auditing of the enforcement actions.
# NIST SP 800-53 Revision 4 :: CM-5 (1)
#
#
- name: check stig_rhel7_v1r4 v_72259
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72259': 'fail'})}}"
  when: '"v_72259" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72261
# Severity: medium
# Group Title: SRG-OS-000364-GPOS-00151
# Rule ID: SV-86885r2_rule
# STIG ID: RHEL-07-040440
# Rule Title: The SSH daemon must not permit Kerberos authentication unless needed.
# Discussion: Kerberos authentication for SSH is often implemented using Generic Security Service Application Program Interface (GSSAPI). If Kerberos is enabled through SSH, the SSH daemon provides a means of access to the system's Kerberos implementation. Vulnerabilities in the system's Kerberos implementation may then be subject to exploitation. To reduce the attack surface of the system, the Kerberos authentication mechanism within SSH must be disabled for systems not using this capability.
# IA Controls:
# Check Content: Verify the SSH daemon does not permit Kerberos to authenticate passwords unless approved.
#
# Check that the SSH daemon does not permit Kerberos to authenticate passwords with the following command:
#
# # grep -i kerberosauth /etc/ssh/sshd_config
# KerberosAuthentication no
#
# If the "KerberosAuthentication" keyword is missing, or is set to "yes" and is not documented with the Information System Security Officer (ISSO), or the returned line is commented out, this is a finding.
# Fix Text: Uncomment the "KerberosAuthentication" keyword in "/etc/ssh/sshd_config" (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor) and set the value to "no":
#
# KerberosAuthentication no
#
# The SSH service must be restarted for changes to take effect.
#
# If Kerberos authentication is required, it must be documented, to include the location of the configuration file, with the ISSO.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000318
# The organization audits and reviews activities associated with configuration controlled changes to the system.
# NIST SP 800-53 :: CM-3 e
# NIST SP 800-53A :: CM-3.1 (v)
# NIST SP 800-53 Revision 4 :: CM-3 f
#
# CCI-000368
# The organization documents any deviations from the established configuration settings for organization-defined information system components based on organization-defined operational requirements.
# NIST SP 800-53 :: CM-6 c
# NIST SP 800-53A :: CM-6.1 (v)
# NIST SP 800-53 Revision 4 :: CM-6 c
#
# CCI-001812
# The information system prohibits user installation of software without explicit privileged status.
# NIST SP 800-53 Revision 4 :: CM-11 (2)
#
# CCI-001813
# The information system enforces access restrictions.
# NIST SP 800-53 Revision 4 :: CM-5 (1)
#
# CCI-001814
# The Information system supports auditing of the enforcement actions.
# NIST SP 800-53 Revision 4 :: CM-5 (1)
#
#
- name: check stig_rhel7_v1r4 v_72261
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72261': 'fail'})}}"
  when: '"v_72261" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72263
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86887r2_rule
# STIG ID: RHEL-07-040450
# Rule Title: The SSH daemon must perform strict mode checking of home directory configuration files.
# Discussion: If other users have access to modify user-specific SSH configuration files, they may be able to log on to the system as another user.
# IA Controls:
# Check Content: Verify the SSH daemon performs strict mode checking of home directory configuration files.
#
# The location of the "sshd_config" file may vary if a different daemon is in use.
#
# Inspect the "sshd_config" file with the following command:
#
# # grep -i strictmodes /etc/ssh/sshd_config
#
# StrictModes yes
#
# If "StrictModes" is set to "no", is missing, or the returned line is commented out, this is a finding.
# Fix Text: Uncomment the "StrictModes" keyword in "/etc/ssh/sshd_config" (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor) and set the value to "yes":
#
# StrictModes yes
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72263
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72263': 'fail'})}}"
  when: '"v_72263" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72265
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86889r2_rule
# STIG ID: RHEL-07-040460
# Rule Title: The SSH daemon must use privilege separation.
# Discussion: SSH daemon privilege separation causes the SSH process to drop root privileges when not needed, which would decrease the impact of software vulnerabilities in the unprivileged section.
# IA Controls:
# Check Content: Verify the SSH daemon performs privilege separation.
#
# Check that the SSH daemon performs privilege separation with the following command:
#
# # grep -i usepriv /etc/ssh/sshd_config
#
# UsePrivilegeSeparation sandbox
#
# If the "UsePrivilegeSeparation" keyword is set to "no", is missing, or the retuned line is commented out, this is a finding.
# Fix Text: Uncomment the "UsePrivilegeSeparation" keyword in "/etc/ssh/sshd_config" (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor) and set the value to "sandbox" or "yes":
#
# UsePrivilegeSeparation sandbox
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72265
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72265': 'fail'})}}"
  when: '"v_72265" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72267
# Severity: medium
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86891r2_rule
# STIG ID: RHEL-07-040470
# Rule Title: The SSH daemon must not allow compression or must only allow compression after successful authentication.
# Discussion: If compression is allowed in an SSH connection prior to authentication, vulnerabilities in the compression software could result in compromise of the system from an unauthenticated connection, potentially with root privileges.
# IA Controls:
# Check Content: Verify the SSH daemon performs compression after a user successfully authenticates.
#
# Check that the SSH daemon performs compression after a user successfully authenticates with the following command:
#
# # grep -i compression /etc/ssh/sshd_config
# Compression delayed
#
# If the "Compression" keyword is set to "yes", is missing, or the retuned line is commented out, this is a finding.
# Fix Text: Uncomment the "Compression" keyword in "/etc/ssh/sshd_config" (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor) on the system and set the value to "delayed" or "no":
#
# Compression no
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72267
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72267': 'fail'})}}"
  when: '"v_72267" in stig_rhel7_v1r4_checks'


# Vuln ID: V-72303
# Severity: high
# Group Title: SRG-OS-000480-GPOS-00227
# Rule ID: SV-86927r3_rule
# STIG ID: RHEL-07-040710
# Rule Title: Remote X connections for interactive users must be encrypted.
# Discussion: Open X displays allow an attacker to capture keystrokes and execute commands remotely.
# IA Controls:
# Check Content: Verify remote X connections for interactive users are encrypted.
#
# Check that remote X connections are encrypted with the following command:
#
# # grep -i x11forwarding /etc/ssh/sshd_config
#
# X11Forwarding yes
#
# If the "X11Forwarding" keyword is set to "no", is missing, or is commented out, this is a finding.
# Fix Text: Configure SSH to encrypt connections for interactive users.
#
# Edit the "/etc/ssh/sshd_config" file to uncomment or add the line for the "X11Forwarding" keyword and set its value to "yes" (this file may be named differently or be in a different location if using a version of SSH that is provided by a third-party vendor):
#
# X11Forwarding yes
#
# The SSH service must be restarted for changes to take effect.
# False Positives:
# False Negatives:
# Documentable: false
# Mitigations:
# Potential Impact:
# Third Party Tools:
# Mitigation Control:
# Responsibility:
# Severity Override Guidance:
# Check Content Reference: M
# Classification: Unclass
# STIG: Red Hat Enterprise Linux 7 Security Technical Implementation Guide :: Release: 4 Benchmark Date: 26 Jan 2018
# VMS Asset Posture:
#  CCI: CCI-000366
# The organization implements the security configuration settings.
# NIST SP 800-53 :: CM-6 b
# NIST SP 800-53A :: CM-6.1 (iv)
# NIST SP 800-53 Revision 4 :: CM-6 b
#
#
- name: check stig_rhel7_v1r4 v_72303
  set_fact:
    stig_rhel7_v1r4_results: "{{stig_rhel7_v1r4_results|combine({'v_72303': 'fail'})}}"
  when: '"v_72303" in stig_rhel7_v1r4_checks'

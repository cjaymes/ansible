<disk type='{{dev.type}}' device='{{dev.device}}'{%- if dev.rawio is defined -%} rawio='{{dev.rawio}}'{%- endif -%}{%- if dev.sgio is defined -%} sgio='{{dev.sgio}}'{%- endif -%}{%- if dev.snapshot is defined -%} snapshot='{{dev.snapshot}}'{%- endif -%}>
    {%- source_type = dev.type -%}
    {%- source = dev.source -%}
    {%- include 'device/disk_source.xml.j2'}
    {%- if dev.backing_store is defined -%}
        {% set backing_store = dev.backing_store %}
        {% include 'disk_backing_store.xml.j2' %}
    {%- endif -%}
    {# TODO mirror #}
    {%- if dev.target is defined -%}
        <target dev='{{dev.target.dev}}'{%- if dev.target.bus is defined -%} bus='{{dev.target.bus}}'{%- endif -%}{%- if dev.target.tray is defined -%} tray='{{dev.target.tray}}'{%- endif -%}{%- if dev.target.removable is defined -%} removable='{{dev.target.removable}}'{%- endif -%}/>
    {%- endif -%}
    {# TODO iotune #}
    {%- if dev.driver is defined -%}
        <driver name='{{dev.driver.name}}'{%- if dev.driver.type is defined -%} type='{{dev.driver.type}}'{%- endif -%}{%- if dev.driver.cache is defined -%} cache='{{dev.driver.cache}}'{%- endif -%}{%- if dev.driver.error_policy is defined -%} error_policy='{{dev.driver.error_policy}}'{%- endif -%}{%- if dev.driver.io is defined -%} io='{{dev.driver.io}}'{%- endif -%}{%- if dev.driver.ioeventfd is defined -%} ioeventfd='{{dev.driver.ioeventfd}}'{%- endif -%}{%- if dev.driver.event_idx is defined -%} event_idx='{{dev.driver.event_idx}}'{%- endif -%}{%- if dev.driver.copy_on_read is defined -%} copy_on_read='{{dev.driver.copy_on_read}}'{%- endif -%}{%- if dev.driver.discard is defined -%} discard='{{dev.driver.discard}}'{%- endif -%}{%- if dev.driver.detect_zeroes is defined -%} detect_zeroes='{{dev.driver.detect_zeroes}}'{%- endif -%}{%- if dev.driver.iothread is defined -%} iothread='{{dev.driver.iothread}}'{%- endif -%}{%- if dev.driver.queues is defined -%} queues='{{dev.driver.queues}}'{%- endif -%}/>
        {# TODO virtio attributes #}
    {%- endif -%}
    {# TODO backenddomain #}
    {%- if dev.shareable is defined -%}
        <shareable/>
    {%- endif -%}
    {%- if dev.transient is defined -%}
        <transient/>
    {%- endif -%}
    {%- if dev.serial is defined -%}
        <serial>{{dev.serial}}</serial>
    {%- endif -%}
    {%- if dev.wwn is defined -%}
        <wwn>{{dev.wwn}}</wwn>
    {%- endif -%}
    {%- if dev.vendor is defined -%}
        <vendor>{{dev.vendor}}</vendor>
    {%- endif -%}
    {%- if dev.product is defined -%}
        <product>{{dev.product}}</product>
    {%- endif -%}
    {# TODO geometry}
    {# TODO blockio}
    {%- include 'common.xml.j2' -%}
</disk>

{%- if dev.emulator is defined -%}
    <emulator>{{dev.emulator}}</emulator>
{%- endif -%}

{%- if dev.disk is defined -%}
    <disk type='{{dev.type}}' device='{{dev.device}}'{%- if dev.rawio is defined -%} rawio='{{dev.rawio}}'{%- endif -%}{%- if dev.sgio is defined -%} sgio='{{dev.sgio}}'{%- endif -%}{%- if dev.snapshot is defined -%} snapshot='{{dev.snapshot}}'{%- endif -%}>
        {%- if dev.alias is defined -%}
            <alias name='{{dev.alias.name}}'/>
        {%- endif -%}
        {%- source_type = dev.type -%}
        {%- source = dev.source -%}
        {%- import 'disk_source.xml.j2'}
        {%- if dev.backing_store is defined -%}
            {% set backing_store = dev.backing_store %}
            {% include 'disk_backing_store.xml.j2' %}
        {%- endif -%}
        {# TODO mirror #}
        {%- if dev.target is defined -%}
            <target dev='{{dev.target.dev}}'{%- if dev.target.bus is defined -%} bus='{{dev.target.bus}}'{%- endif -%}{%- if dev.target.tray is defined -%} tray='{{dev.target.tray}}'{%- endif -%}{%- if dev.target.removable is defined -%} removable='{{dev.target.removable}}'{%- endif -%}/>
        {%- endif -%}
        {# TODO iotune #}
        {%- if dev.driver is defined -%}
            <driver name='{{dev.driver.name}}'{%- if dev.driver.type is defined -%} type='{{dev.driver.type}}'{%- endif -%}{%- if dev.driver.cache is defined -%} cache='{{dev.driver.cache}}'{%- endif -%}{%- if dev.driver.error_policy is defined -%} error_policy='{{dev.driver.error_policy}}'{%- endif -%}{%- if dev.driver.io is defined -%} io='{{dev.driver.io}}'{%- endif -%}{%- if dev.driver.ioeventfd is defined -%} ioeventfd='{{dev.driver.ioeventfd}}'{%- endif -%}{%- if dev.driver.event_idx is defined -%} event_idx='{{dev.driver.event_idx}}'{%- endif -%}{%- if dev.driver.copy_on_read is defined -%} copy_on_read='{{dev.driver.copy_on_read}}'{%- endif -%}{%- if dev.driver.discard is defined -%} discard='{{dev.driver.discard}}'{%- endif -%}{%- if dev.driver.detect_zeroes is defined -%} detect_zeroes='{{dev.driver.detect_zeroes}}'{%- endif -%}{%- if dev.driver.iothread is defined -%} iothread='{{dev.driver.iothread}}'{%- endif -%}{%- if dev.driver.queues is defined -%} queues='{{dev.driver.queues}}'{%- endif -%}/>
            {# TODO virtio attributes #}
        {%- endif -%}
        {# TODO backenddomain #}
        {%- if dev.readonly is defined -%}
            <readonly/>
        {%- endif -%}
        {%- if dev.shareable is defined -%}
            <shareable/>
        {%- endif -%}
        {%- if dev.transient is defined -%}
            <transient/>
        {%- endif -%}
        {%- if dev.serial is defined -%}
            <serial>{{dev.serial}}</serial>
        {%- endif -%}
        {%- if dev.wwn is defined -%}
            <wwn>{{dev.wwn}}</wwn>
        {%- endif -%}
        {%- if dev.vendor is defined -%}
            <vendor>{{dev.vendor}}</vendor>
        {%- endif -%}
        {%- if dev.product is defined -%}
            <product>{{dev.product}}</product>
        {%- endif -%}
        {%- if dev.address is defined -%}
            <address type='{{dev.address.type}}'{%- if dev.address.bus is defined -%} bus='{{dev.address.bus}}'{%- endif -%}{%- if dev.address.slot is defined -%} slot='{{dev.address.slot}}'{%- endif -%}{%- if dev.address.function is defined -%} function='{{dev.address.function}}'{%- endif -%}{%- if dev.address.domain is defined -%} domain='{{dev.address.domain}}'{%- endif -%}{%- if dev.address.multifunction is defined -%} multifunction='{{dev.address.multifunction}}'{%- endif -%}{%- if dev.address.controller is defined -%} controller='{{dev.address.controller}}'{%- endif -%}{%- if dev.address.target is defined -%} target='{{dev.address.target}}'{%- endif -%}{%- if dev.address.unit is defined -%} unit='{{dev.address.unit}}'{%- endif -%}/>
        {%- endif -%}
        {# TODO geometry}
        {# TODO blockio}
    </disk>
{%- endif -%}

{# TODO filesystem #}

{# <disk type='file' device='disk'>
<driver name='qemu' type='qcow2'/>
<source file='/var/lib/libvirt/images/dc0-1.qcow2'/>
<backingStore/>
<target dev='hda' bus='ide'/>
<alias name='ide0-0-0'/>
<address type='drive' controller='0' bus='0' target='0' unit='0'/>
</disk>
<disk type='file' device='cdrom'>
<driver name='qemu' type='raw'/>
<source file='/var/lib/libvirt/iso/Windows/SW_DVD9_Windows_Svr_Std_and_DataCtr_2012_R2_64Bit_English_-4_MLF_X19-82891.ISO'/>
<backingStore/>
<target dev='hdb' bus='ide'/>
<readonly/>
<alias name='ide0-0-1'/>
<address type='drive' controller='0' bus='0' target='0' unit='1'/>
</disk>
<controller type='usb' index='0' model='ich9-ehci1'>
<alias name='usb'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x7'/>
</controller>
<controller type='usb' index='0' model='ich9-uhci1'>
<alias name='usb'/>
<master startport='0'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0' multifunction='on'/>
</controller>
<controller type='usb' index='0' model='ich9-uhci2'>
<alias name='usb'/>
<master startport='2'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x1'/>
</controller>
<controller type='usb' index='0' model='ich9-uhci3'>
<alias name='usb'/>
<master startport='4'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x2'/>
</controller>
<controller type='pci' index='0' model='pci-root'>
<alias name='pci.0'/>
</controller>
<controller type='ide' index='0'>
<alias name='ide'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>
</controller>
<controller type='virtio-serial' index='0'>
<alias name='virtio-serial0'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>
</controller>
<interface type='bridge'>
<mac address='52:54:00:36:20:27'/>
<source bridge='br200'/>
<target dev='vnet1'/>
<model type='e1000'/>
<alias name='net0'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
</interface>
<serial type='pty'>
<source path='/dev/pts/1'/>
<target port='0'/>
<alias name='serial0'/>
</serial>
<console type='pty' tty='/dev/pts/1'>
<source path='/dev/pts/1'/>
<target type='serial' port='0'/>
<alias name='serial0'/>
</console>
<channel type='spicevmc'>
<target type='virtio' name='com.redhat.spice.0' state='disconnected'/>
<alias name='channel0'/>
<address type='virtio-serial' controller='0' bus='0' port='1'/>
</channel>
<input type='tablet' bus='usb'>
<alias name='input0'/>
<address type='usb' bus='0' port='1'/>
</input>
<input type='mouse' bus='ps2'>
<alias name='input1'/>
</input>
<input type='keyboard' bus='ps2'>
<alias name='input2'/>
</input>
<graphics type='spice' port='5901' autoport='yes' listen='127.0.0.1'>
<listen type='address' address='127.0.0.1'/>
</graphics>
<video>
<model type='qxl' ram='65536' vram='65536' vgamem='16384' heads='1' primary='yes'/>
<alias name='video0'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>
</video>
<redirdev bus='usb' type='spicevmc'>
<alias name='redir0'/>
<address type='usb' bus='0' port='2'/>
</redirdev>
<redirdev bus='usb' type='spicevmc'>
<alias name='redir1'/>
<address type='usb' bus='0' port='3'/>
</redirdev>
<memballoon model='virtio'>
<alias name='balloon0'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x0'/>
</memballoon> #}

{%- if feature.pae is defined -%}
    <pae/>
{%- endif -%}
{%- if feature.acpi is defined -%}
    <acpi/>
{%- endif -%}
{%- if feature.apic is defined -%}
    <apic{%- if feature.apic.eoi is defined -%} eoi='{{feature.apic.eoi}}'{%- endif -%}/>
{%- endif -%}
{%- if feature.hap is defined -%}
    <hap{%- if feature.hap.state is defined -%} state='{{feature.hap.state}}'{%- endif -%}/>
{%- endif -%}
{%- if feature.viridian is defined -%}
    <viridian/>
{%- endif -%}
{%- if feature.privnet is defined -%}
    <privnet/>
{%- endif -%}
{%- if feature.hyperv is defined -%}
    <hyperv>{%- for hyperv_feature in feature.hyperv -%}
        {%- if hyperv_feature.relaxed is defined -%}
            <relaxed state='{{hyperv_feature.relaxed.state}}'/>
        {%- endif -%}
        {%- if hyperv_feature.vapic is defined -%}
            <vapic state='{{hyperv_feature.vapic.state}}'/>
        {%- endif -%}
        {%- if hyperv_feature.spinlocks is defined -%}
            <spinlocks state='{{hyperv_feature.spinlocks.state}}' retries='{{hyperv_feature.spinlocks.retries}}'/>
        {%- endif -%}
        {%- if hyperv_feature.vpindex is defined -%}
            <vpindex state='{{hyperv_feature.vpindex.state}}'/>
        {%- endif -%}
        {%- if hyperv_feature.runtime is defined -%}
            <runtime state='{{hyperv_feature.runtime.state}}'/>
        {%- endif -%}
        {%- if hyperv_feature.synic is defined -%}
            <synic state='{{hyperv_feature.synic.state}}'/>
        {%- endif -%}
        {%- if hyperv_feature.stimer is defined -%}
            <stimer state='{{hyperv_feature.stimer.state}}'/>
        {%- endif -%}
        {%- if hyperv_feature.reset is defined -%}
            <reset state='{{hyperv_feature.reset.state}}'/>
        {%- endif -%}
        {%- if hyperv_feature.vendor_id is defined -%}
            <vendor_id state='{{hyperv_feature.vendor_id.state}}' value='{{hyperv_feature.vendor_id.value}}'/>
        {%- endif -%}
        {%- if hyperv_feature.frequencies is defined -%}
            <frequencies state='{{hyperv_feature.frequencies.state}}'/>
        {%- endif -%}
        {%- if hyperv_feature.reenlightenment is defined -%}
            <reenlightenment state='{{hyperv_feature.reenlightenment.state}}'/>
        {%- endif -%}
        {%- if hyperv_feature.tlbflush is defined -%}
            <tlbflush state='{{hyperv_feature.tlbflush.state}}'/>
        {%- endif -%}
    {%- endfor -%}</hyperv>
{%- endif -%}
{%- if feature.pvspinlock is defined -%}
    <pvspinlock state='{{feature.pvspinlock.state}}'/>
{%- endif -%}
{%- if feature.kvm is defined -%}
    <kvm>{%- for kvm_feature in feature.kvm -%}
        {%- if kvm_feature.hidden is defined -%}
            <hidden state='{{kvm_feature.hidden.state}}'/>
        {%- endif -%}
    {%- endfor -%}</kvm>
{%- endif -%}
{%- if feature.pmu is defined -%}
    <pmu state='{{feature.pmu.state}}'/>
{%- endif -%}
{%- if feature.vmport is defined -%}
    <vmport state='{{feature.vmport.state}}'/>
{%- endif -%}
{%- if feature.gic is defined -%}
    <gic version='{{feature.gic.version}}'/>
{%- endif -%}
{%- if feature.smm is defined -%}
    <smm state='{{feature.smm.state}}'>
        <tseg unit='{{feature.smm.tseg.unit}}'>{{feature.smm.tseg.size}}</tseg>
    </smm>
{%- endif -%}
{%- if feature.ioapic is defined -%}
    <ioapic driver='{{feature.ioapic.driver}}'/>
{%- endif -%}
{%- if feature.hpt is defined -%}
    <hpt resizing='{{feature.hpt.resizing}}'>
    {%- if feature.hpt.maxpagesize is defined -%}
        <maxpagesize unit='{{feature.hpt.maxpagesize.unit}}'>{{feature.hpt.maxpagesize.size}}</maxpagesize>
    {%- endif -%}
    </hpt>
{%- endif -%}
{%- if feature.vmcoreinfo is defined -%}
    <vmcoreinfo/>
{%- endif -%}
{%- if feature.htm is defined -%}
    <htm state='{{feature.htm.state}}'/>
{%- endif -%}
